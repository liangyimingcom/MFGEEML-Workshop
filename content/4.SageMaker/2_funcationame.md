---
title: "需求分析与预测结果"
chapter: false
weight: 42
---

## 二、需求分析与预测结果

### 1）预测维护的实验数据集

说明：

- 文件名：121007060_1.csv 
- 数据规模：180W行 含故障代的关联性分析与提起周期预测（数据）：
- 数据说明：error code列为故障代码列，已经将设备故障代码（单独为一列）合并到设备状态记录中去，方便训练，请下图说明
- 业务目标：对报错设备（error code字段）的关联性分析与提前故障周期预测；
- 图例（重点）：请忽略红色标记的无用字段；

<img src="https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210327234446954.png" alt="image-20210327234446954" style="zoom: 50%;" />



### 2）预测维护需求说明

（下图）

![image-20210328000503896](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328000503896.png)

 

### 3）特征工程

![image-20210328000518141](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328000518141.png)

通过图表分析，已经找到的相关性列如下：（请参考源码）



### 4）使用“滑窗”方法，将特征工程后的时间序列数据集

通过滑动窗口转化为有监督学习数据集（如下），然后使用XGBoost做回归训练；

![image-20210327235834004](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210327235834004.png)



### 5）预测结果

1. 《预测性维护》需求场景验证成功，用户现有的数据集可以实现故障提前周期的预测；
2. 数据预处理中《滑窗》次数越多，预测准确度越高。超过100个《滑窗》提高了预测模型的准确性。（100个滑窗的数据集，分别为5、10、20、30、40、50分钟的6个预测模型）
3. 提前周期从5分钟到50分钟，预测《有故障》的准确率较高，召回率有待提高。 
4. 在反复数据预处理和XGBoost调参训练后，使用Sagemaker将预测准确度AUC从0.79提高到0.93；

![image-20210328000438018](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328000438018.png)



索取实验数据，请[点击](mailto:me@liangyiming.com)这里。



## 三、滑动窗口原理解析

滑动窗口方法，是使用先前的时间步长预测下一个时间步长，在统计资料中它也称为滞后法。使用滑动窗口方法，可以将《多元时间序列数据集》转换为《监督学习问题》，应该怎么实现呢？ 

定义问题通常是解决任何问题的第一步。我们需要先从问题的定义讲起：

### 时间序列问题的类型

关于时间序列问题，我们可以将问题分为以下几类：

1. **回归或分类**：要预测的变量是数字的还是（字母）分类的。

2. **非结构化或结构化**：数据是否具有实际值？如果它确实具有实际值和结构化的列，我们将其称为“结构化”。否则，其称为非结构化图像。

3. **单变量 或多变量**。除了日期列外，如果只有一列存储值，我们将其称为单变量 。如果date列之外还有多个列，我们将其称为多变量。

4. **单步或者多步**。如果我们要预测第二天，我们将其称为单步。如果我们要预测未来两天或更长时间，则将其称为多步。



### 实验数据集的类型：

针对本次预测性维护的实验数据（表3-1），总结出时序问题的分类为：

- [ ] 回归
- [ ] 结构化
- [ ] 多变量
- [ ] 多步

| Time | Value1 | Value2 |      | 实验数据的时间序列类型分析 |
| :--: | :----: | :----: | ---- | -------------------------- |
|  1   |   30   |   80   |      | **回归**                   |
|  2   |   40   |   90   |      | **结构化**                 |
|  3   |   50   |  100   |      | **多变量**                 |
|  4   |   60   |  110   |      | **多步**                   |
|  5   |   70   |  120   |      | **此列仅为说明**           |

（表3-1）



### 使用滑动窗口方法转换数据

滑动窗口方法是基础，把一个时间序列问题转化为监督学习的问题。滑动窗口方法的定义是使用先前的时间步长预测下一个时间步长。这里举例说明如何将多元数据转换为监督学习问题。

<br>原数据集：

| Time | Value1 | Value2 |
| ---- | ------ | ------ |
| 1    | 30     | 80     |
| 2    | 40     | 90     |
| 3    | 50     | 100    |
| 4    | 60     | 110    |
| 5    | 70     | 120    |

让我们应用滑动窗口方法：

| Value1 | Value2 | Value1 | Result(预测Value2) |
| ------ | ------ | ------ | ------------------ |
| ?      | ?      | 30     | **80**             |
| 30     | 80     | 40     | **90**             |
| 40     | 90     | 50     | **100**            |
| 50     | 100    | 60     | **110**            |
| 60     | 110    | 70     | **120**            |
| 70     | 120    | ?      | **?**              |

**通过以上数据集的重构，将时间序列数据转化为监督学习数据，从而实现预测Value2（Result字段）。**

*BTW：这很有趣。据我所知，除了人工神经网络之外，没想到有其他的监督学习算法可以预测多个变量。*



让我们继续，实现多步预测：

对于预测性维护场景，真实的业务需求 - 预测多步比预测单步要有价值得多（如：提前1小时发现可能出现的故障，价值大于提前1分钟发现故障）。下面是使用滑动窗口方法转换变量数据进行多步预测的示例：

![image-20210328002702027](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328002702027.png)



### 滑动窗口方法在实验数据集的验证结果：

针对实验数据集，将滑窗的数量从10 提升到30，可以显著观察到故障识别准确度发生了提升。

![image-20210328002503360](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328002503360.png)

![image-20210328002524584](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328002524584.png)

![image-20210328002536995](https://raw.githubusercontent.com/liangyimingcom/storage/master/uPic/image-20210328002536995.png)



